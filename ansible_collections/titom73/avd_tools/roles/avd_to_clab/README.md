# Arista AVD eos_designs to containerlab

**eos_designs_to_containerlab** is a role to build a [containerlab](https://containerlab.srlinux.dev/) topology from [Arista AVD](https://www.avd.sh) project

## Requirements

Requirements are located here: [avd-requirements](../../README.md#Requirements)

- [**containerlab**](https://containerlab.srlinux.dev/) in version `>=0.15.3`

```bash
$ containerlab version
                           _                   _       _
                 _        (_)                 | |     | |
 ____ ___  ____ | |_  ____ _ ____   ____  ____| | ____| | _
/ ___) _ \|  _ \|  _)/ _  | |  _ \ / _  )/ ___) |/ _  | || \
( (__| |_|| | | | |_( ( | | | | | ( (/ /| |   | ( ( | | |_) )
\____)___/|_| |_|\___)_||_|_|_| |_|\____)_|   |_|\_||_|____/

    version: 0.15.3
     commit: 533d911
       date: 2021-07-19T14:35:16Z
     source: https://github.com/srl-labs/containerlab
 rel. notes: https://containerlab.srlinux.dev/rn/0.15/#0153
```


## Default Variables

The following default variables are defined, and can be modified as desired:

- `containerlabs_configuration`: Location and name of the containerlabs configuration generated. (default: `{{ inventory_dir }}/containerlabs.yml`)
- `ceos_lab_version`: Version of cEOS to use for the topology (default: 4.25.2F)
- `mgmt_network_v4`: Subnet for management IPs use for OOB
- `eapi_base`: Base port to use to expose eAPI from containers. Uses `eapi_base` + `device_id` from `arista.avd.eos_designs`

> If host has `ansible_port` defined and different than `443`, then, this value is used instead of an autogenerated one.

```yaml
# cEOS Image to use
ceos_lab_version: ceos:latest

# Default management network IP
mgmt_network_v4: 192.168.1.0/24

# Default containerlabs configuration file generated
containerlab_configuration: '{{ inventory_dir }}/containerlabs.yml'

# Default port to generate eAPI port mapping: eapi_base + device_id
eapi_base: 8000
```

## Extend your topology

As `arista.avd.eos_designs` only support definition of network devices, this role implement options to extend your Containerlab topology to attach additional components to your topology:

- `clab_nodes`: Add node definitions using Containerlab syntax
- `clab_links`: Add links to your topology using Containerlab definition
- `clab_kinds`: Add kind options to your topology

### Example

```yaml
clab_kinds:
  linux:
    image: alpine:latest


clab_nodes:
  client12:
    kind: linux
    image: titom73/network-multitool:extra
    mgmt_ipv4: 10.73.255.192
  client22:
    kind: linux
    image: titom73/network-multitool:extra
    mgmt_ipv4: 10.73.255.194

clab_links:
 - endpoints: ["ceos-agg02:eth3", "client21:eth1"]
 - endpoints: ["ceos-agg02:eth1", "client21:eth1"]
```

## Example Playbook

Here is a playbook example to use `arista.avd.eos_designs_to_containerlab`:

```yaml
---
- name: Build containerlab topology
  hosts: DC1_FABRIC
  connection: local
  gather_facts: false
  tasks:
    - name: 'Build a containerlab topolgy'
      import_role:
        name: titom73.avd_tools.eos_designs_to_containerlab
      vars:
        mgmt_network_v4: 10.73.255.0/24
        ceos_version: arista/ceos:4.27.1F
        eapi_base: 8000
```

## License

Project is published under [Apache 2.0 License](../../LICENSE)
